

定义及说明
==========
 * 登录服务器：提供玩家注册登录页面的服务器，使用redis，mongodb,nginx,php,处理权限，处理玩家支付(可选,如需要统一支付币入口)
 * 游戏服务器：玩家连接服务器，处理玩家通过网络的游戏操作处理
 * 游戏数据：  玩家在游戏数据记录，完整逻辑数据存档,玩家可以有几份数据

设计点
=====
 * 数据库使用mongo，玩家数据在游戏服务器有数据库之间定期同步
 * 游戏服务器为长连接服务器
 * 使用id生成器和登录服务器做到预先分区分库 
 * 游戏服务器可以随时重启(对玩家影响不大) 
 * 使用json/gzip通讯
 * 排行和等级等索引列表，使用redis
 * *使用时间戳，保留2个版本游戏数据(save后，在登录服务器更新最新数据,可选热备)* 
   在游戏服务器处理，定期往备份服务器写入数据


模块介绍
==========
 * 登录服务(http,nginx,nodejs)
   跟现有平台iframe逻辑一致，生成登录token(包含玩家内部id和登录时间)
   根据各个游戏服务器已经连接玩家情况，选择游戏服务器，发给前端
   * 功能:
     1. 前端使用登录token，连接游戏服务器
	 2. 注册（可选)
	 3. 登录，完成平台授权或用户名密码登录,生成登录页面，返回登录信息
	 4. 支付相关，充值回调，用户消费(不同服务器)等
	 5. 获取好友id信息
	 6. 选择游戏服务器逻辑(根据分服，不分服区别处理)
	 7. 获取任意玩家数据

   * 实现：(暂定)
     1. 一个id转换redis  -- Idgen
	 2. 一个redis存储具体数据，一个玩家数据key： 一个hash表存平台信息（登录验证信息)，付费，游戏数据记录信息id，
	 3. 一个redis session 服务器 一个hash存session数据，一个list 好友列表
	 4. 可选使用mongodb

 * 游戏服务器
   处理玩家长连接和游戏逻辑,所有玩家数据放在服务器器内存

  * 功能:
    1. 登录，验证登录token，更新本服务器玩家连接数，通过后可以连接继续下一步，
	2. 数据库load，save玩家逻辑数据
	3. 游戏逻辑请求处理，聊天信息处理
	4. 战斗过程计算
	5. 获取本服玩家数据，获取其他服玩家数据

 * 跨服务器层
   游戏服务器间通信 @聊天广播信息
   * 功能

 * 分库
   * 游戏数据根据id，50w-200w玩家一个mongodb库


分服与不分服的处理
==================
 * 分服:
   没有游戏服务器之间通信，
   玩家好友只在一个服务器上(每个游戏服务器需保留一套玩家游戏数据),玩家登陆不同服务器有不同的游戏数据
   排行数据处理,只处理本服务器

 * 不分服:
   需要跨服务层，游戏服务器对玩家透明(整个系统只有一套玩家游戏数据)

 * 实现:
   技术实现上屏蔽这种差异,每个玩家的游戏数据由连接的游戏服务器决定，在登录服务器处理分服逻辑
   有用的结构
   不同排行榜，使用redis,存储玩家等级，等索引

实现技术
========
 * [nodejs](http://nodejs.org/api/),web服务引擎
 * [socket.io](http://socket.io/#how-to-use)
 * hook.io -- 进程间通信
 * mocha  -- bdd测试框架 
 * stylus,jade

FALLBACK
========
 没有涉及到的内容(使用原有系统)

 * 后台管理
 * 配置发布等工具
 * 统计(mongodb,hadoop)

意见记录
=======

补充和修改
=========
 * 12/04/16: init
 * 12/04/21:  登录部分代码使用node实现


